# Распределенные приложения МАИ 2023 
## Проект A2 - Бронирование комнат (Air BnB)
### Используемые технологии
- Python 3.11 - Оснвной Яп
- Fastapi - rest-api приложение
- Mongodb - риентированная на документы база данных NoSQL
- ElasticSearch - полнотекстовый поиск и бронирование
- Redis - блокировка комнаты на время бронирования
- Docker - автоматизации развертывания приложений в виде переносимых автономных контейнеров
- Docker compose - оркестрация и запуск кластера
### Сценарии использования
- get/user/ - получить всех пользователей
- post/user/ -создать нового пользователя
- get/user/{id} - получить пользователя по id
- get/room/ - получить список всех комнат
- post/room/ - создать новую комнату
- get/room/find - найти свободные на заданные даты комнаты
- get/room/{id} - получить комнату по id
- get/booking/ - получить список всех бронирований
- post/booking/ - забронировать комнату
- get/booking/{id} - получить бронирование по id
### Конфигурация rest-api приложения
Переменные окружения по умолчанию передаются в контейнер app с помощью docker-compose.yml
|Переменная|Назначение|
|--------|-----------------------------------|
|MONGO_URI|строка подключения к mongodb|
|DB_NAME|используемая база данных mongodb|
|ELASTICSEARCH_URI|строка подключения к elasticsearch|
|REDIS_URI|строка подключения к redis|
|USER_PARSER_PATH|путь к Users.xml|
|USER_DATA_PATH|путь к Users.сsv|
|ROOM_DATA_PATH|путь к tomslee_airbnb_auckland_0534_2016-08-19.csv|
### Запуск кластера в docker
Запуск:
```
docker compose up -d
```
Состав кластера:
- mongodb - режим кластера, mongo01:27017, mongo02:27018, mongo03:27019 + один инициализирующий mongoinit
- elasticsearch - режим кластера, es01:9201, es02:9202, es03:9203 + kibana:5601
- redis - redis:6379
- приложение на python - app:8000
### Поведение под нагрузкой

| Состояние          | Работа (чтение/запись) | Отчёт | Дополнительные комментарии|
|---|---|---|---|
| 3 контейнера Mongo | да/да | Весь функционал приложения работает | Штатный режим работы кластера.
| 2 контейнера Mongo | да/да | Весь функционал приложения работает | Остановлен PRIMARY-контейнер mongo01.
| 1 контейнер  Mongo |нет/нет| Функционал приложения не работает   | Остановлены два контейнера Mongo
| 3 контейнера ES | да/да | Функционал бронирования работает исправно| Штатный режим работы кластера.
| 2 контейнера ES | да/да | Функционал бронирования работает исправно| Остановлен PRIMARY-контейнер es03.
| 1 контейнер  ES |нет/нет| Функционал бронирования недоступен       | Остановлены два контейнера Elastic